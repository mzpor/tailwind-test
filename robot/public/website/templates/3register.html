<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… - Ù…Ø¯Ø±Ø³Ù‡ Ù‚Ø±Ø¢Ù† Ø§Ø³ØªØ§Ø¯ Ø¹Ù„ÛŒ Ù…Ø­Ø±Ø§Ø¨ÛŒ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="auth-card register-card">
            <div class="auth-header">
                <div class="auth-logo">
                    <div class="logo-icon">â˜ªï¸</div>
                    <h2>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ù…Ø¯Ø±Ø³Ù‡ Ù‚Ø±Ø¢Ù†</h2>
                </div>
                <p>ÙØ±Ù… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯</p>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="registration-steps">
                <div class="step-indicator">
                    <div class="step active" data-step="1">
                        <span class="step-number">1</span>
                        <span class="step-title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</span>
                    </div>
                    <div class="step" data-step="2">
                        <span class="step-number">2</span>
                        <span class="step-title">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</span>
                    </div>
                    <div class="step" data-step="3">
                        <span class="step-number">3</span>
                        <span class="step-title">ØªÚ©Ù…ÛŒÙ„</span>
                    </div>
                </div>
            </div>

            <form method="POST" class="auth-form multi-step-form" id="registrationForm">
                <!-- Ù…Ø±Ø­Ù„Ù‡ 1: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ -->
                <div class="form-step active" data-step="1">
                    <h3 class="step-header">ğŸ¯ Ù‚Ø¯Ù… Û± Ø§Ø² Û³: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</h3>
                    
                    <div class="form-group">
                        <label for="full_name">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ *</label>
                        <input type="text" id="full_name" name="full_name" required 
                               placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ">
                    </div>

                    <div class="form-group">
                        <label for="national_id">Ú©Ø¯ Ù…Ù„ÛŒ *</label>
                        <input type="text" id="national_id" name="national_id" required 
                               placeholder="Ú©Ø¯ Ù…Ù„ÛŒ Û±Û° Ø±Ù‚Ù…ÛŒ" maxlength="10" pattern="[0-9]{10}">
                    </div>

                    <div class="form-group">
                        <label for="phone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† *</label>
                        <input type="tel" id="phone" name="phone" required 
                               placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡" pattern="[0-9]{11}">
                    </div>

                    <div class="form-navigation">
                        <button type="button" class="btn btn-primary btn-full" onclick="nextStep(1)">
                            Ø§Ø¯Ø§Ù…Ù‡ â† 
                        </button>
                    </div>
                </div>

                <!-- Ù…Ø±Ø­Ù„Ù‡ 2: Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± -->
                <div class="form-step" data-step="2">
                    <h3 class="step-header">ğŸ” Ù‚Ø¯Ù… Û² Ø§Ø² Û³: Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</h3>
                    
                    <div class="form-group">
                        <label for="password">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± *</label>
                        <input type="password" id="password" name="password" required 
                               placeholder="Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ±" minlength="6">
                    </div>

                    <div class="form-group">
                        <label for="confirm_password">ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± *</label>
                        <input type="password" id="confirm_password" name="confirm_password" required 
                               placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>

                    <div class="form-navigation">
                        <button type="button" class="btn btn-secondary" onclick="prevStep(2)">
                            â†’ Ù…Ø±Ø­Ù„Ù‡ Ù‚Ø¨Ù„
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep(2)">
                            Ø§Ø¯Ø§Ù…Ù‡ â†
                        </button>
                    </div>
                </div>

                <!-- Ù…Ø±Ø­Ù„Ù‡ 3: ØªÚ©Ù…ÛŒÙ„ -->
                <div class="form-step" data-step="3">
                    <h3 class="step-header">âœ… Ù‚Ø¯Ù… Û³ Ø§Ø² Û³: ØªÚ©Ù…ÛŒÙ„ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h3>
                    
                    <div class="registration-summary">
                        <h4>ğŸ“‹ Ø®Ù„Ø§ØµÙ‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª:</h4>
                        <div class="summary-item">
                            <span class="label">Ù†Ø§Ù…:</span>
                            <span class="value" id="summary-name">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Ú©Ø¯ Ù…Ù„ÛŒ:</span>
                            <span class="value" id="summary-national-id">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">ØªÙ„ÙÙ†:</span>
                            <span class="value" id="summary-phone">-</span>
                        </div>
                    </div>

                    <!-- ÙÛŒÙ„Ø¯ Ù…Ø®ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ¹ Ú©Ø§Ø±Ø¨Ø± -->
                    <input type="hidden" name="user_type" value="quran_student">

                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" required>
                            <span class="checkmark"></span>
                            Ø¨Ø§ <a href="#" target="_blank">Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ù…Ù‚Ø±Ø±Ø§Øª</a> Ù…ÙˆØ§ÙÙ‚Ù…
                        </label>
                    </div>

                    <div class="form-navigation">
                        <button type="button" class="btn btn-secondary" onclick="prevStep(3)">
                            â†’ Ù…Ø±Ø­Ù„Ù‡ Ù‚Ø¨Ù„
                        </button>
                        <button type="submit" class="btn btn-success btn-full">
                            ğŸ‰ ØªÚ©Ù…ÛŒÙ„ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                        </button>
                    </div>
                </div>
            </form>

            <div class="auth-footer">
                <p>Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ <a href="/login">ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯</a></p>
                <a href="/" class="back-link">â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
            </div>
        </div>

        <div class="auth-decoration">
            <div class="quran-pattern">
                <div class="pattern-element">ğŸ“–</div>
                <div class="pattern-element">â˜ªï¸</div>
                <div class="pattern-element">â­</div>
                <div class="pattern-element">ğŸ•Œ</div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        let currentStep = 1;

        function nextStep(step) {
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ø±Ø­Ù„Ù‡ ÙØ¹Ù„ÛŒ
            if (!validateCurrentStep(step)) {
                return;
            }

            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù…Ø±Ø­Ù„Ù‡ ÙØ¹Ù„ÛŒ
            document.querySelector(`.form-step[data-step="${step}"]`).classList.remove('active');
            document.querySelector(`.step[data-step="${step}"]`).classList.remove('active');
            document.querySelector(`.step[data-step="${step}"]`).classList.add('completed');

            // Ù†Ù…Ø§ÛŒØ´ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ
            const nextStepNum = step + 1;
            document.querySelector(`.form-step[data-step="${nextStepNum}"]`).classList.add('active');
            document.querySelector(`.step[data-step="${nextStepNum}"]`).classList.add('active');
            
            currentStep = nextStepNum;

            // Ø§Ú¯Ø± Ù…Ø±Ø­Ù„Ù‡ 3 Ø§Ø³ØªØŒ Ø®Ù„Ø§ØµÙ‡ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
            if (nextStepNum === 3) {
                showSummary();
            }
        }

        function prevStep(step) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù…Ø±Ø­Ù„Ù‡ ÙØ¹Ù„ÛŒ
            document.querySelector(`.form-step[data-step="${step}"]`).classList.remove('active');
            document.querySelector(`.step[data-step="${step}"]`).classList.remove('active');

            // Ù†Ù…Ø§ÛŒØ´ Ù…Ø±Ø­Ù„Ù‡ Ù‚Ø¨Ù„ÛŒ
            const prevStepNum = step - 1;
            document.querySelector(`.form-step[data-step="${prevStepNum}"]`).classList.add('active');
            document.querySelector(`.step[data-step="${prevStepNum}"]`).classList.add('active');
            document.querySelector(`.step[data-step="${prevStepNum}"]`).classList.remove('completed');
            
            currentStep = prevStepNum;
        }

        function validateCurrentStep(step) {
            const currentStepElement = document.querySelector(`.form-step[data-step="${step}"]`);
            const inputs = currentStepElement.querySelectorAll('input[required]');
            
            for (let input of inputs) {
                if (!input.value.trim()) {
                    input.focus();
                    showError(`Ù„Ø·ÙØ§Ù‹ ${input.previousElementSibling.textContent} Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯`);
                    return false;
                }
                
                if (input.pattern && !new RegExp(input.pattern).test(input.value)) {
                    input.focus();
                    showError(`ÙØ±Ù…Øª ${input.previousElementSibling.textContent} ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª`);
                    return false;
                }
            }

            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø®Ø§Øµ Ù…Ø±Ø­Ù„Ù‡ 2
            if (step === 2) {
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirm_password').value;
                
                if (password !== confirmPassword) {
                    showError('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ùˆ ØªÚ©Ø±Ø§Ø± Ø¢Ù† Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ù†Ø¯');
                    return false;
                }
                
                if (password.length < 6) {
                    showError('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
                    return false;
                }
            }

            return true;
        }

        function showSummary() {
            document.getElementById('summary-name').textContent = document.getElementById('full_name').value;
            document.getElementById('summary-national-id').textContent = document.getElementById('national_id').value;
            document.getElementById('summary-phone').textContent = document.getElementById('phone').value;
        }

        function showError(message) {
            // Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
            const existingError = document.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }

            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.style.cssText = `
                background: #ff4757;
                color: white;
                padding: 10px;
                border-radius: 5px;
                margin: 10px 0;
                text-align: center;
                animation: shake 0.5s;
            `;
            errorDiv.textContent = message;

            const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"]`);
            currentStepElement.insertBefore(errorDiv, currentStepElement.firstChild);

            // Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ø¹Ø¯ Ø§Ø² 3 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.remove();
                }
            }, 3000);
        }

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù… Ø¯Ø± Ø²Ù…Ø§Ù† Ø§Ø±Ø³Ø§Ù„
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            if (!validateCurrentStep(3)) {
                e.preventDefault();
                return false;
            }
        });

        // Ø¨Ø±Ø±Ø³ÛŒ ØªØ·Ø§Ø¨Ù‚ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¯Ø± Ø²Ù…Ø§Ù† ÙˆØ§Ù‚Ø¹ÛŒ
        document.getElementById('confirm_password').addEventListener('input', function() {
            const password = document.getElementById('password').value;
            const confirmPassword = this.value;
            
            if (password !== confirmPassword) {
                this.setCustomValidity('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ø¯');
                this.style.borderColor = '#ff4757';
            } else {
                this.setCustomValidity('');
                this.style.borderColor = '#2ed573';
            }
        });

        // Ø§Ø³ØªØ§ÛŒÙ„ CSS Ø¨Ø±Ø§ÛŒ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
            
            .form-step {
                display: none;
            }
            
            .form-step.active {
                display: block;
                animation: fadeIn 0.3s ease-in;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            .step-indicator {
                display: flex;
                justify-content: center;
                margin-bottom: 30px;
                gap: 20px;
            }
            
            .step {
                display: flex;
                flex-direction: column;
                align-items: center;
                opacity: 0.5;
                transition: all 0.3s;
            }
            
            .step.active {
                opacity: 1;
                color: #2ed573;
            }
            
            .step.completed {
                opacity: 1;
                color: #5352ed;
            }
            
            .step-number {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: #f1f2f6;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-bottom: 8px;
                border: 2px solid transparent;
            }
            
            .step.active .step-number {
                background: #2ed573;
                color: white;
                border-color: #2ed573;
            }
            
            .step.completed .step-number {
                background: #5352ed;
                color: white;
                border-color: #5352ed;
            }
            
            .step-title {
                font-size: 12px;
                text-align: center;
            }
            
            .form-navigation {
                display: flex;
                gap: 10px;
                margin-top: 20px;
            }
            
            .form-navigation .btn {
                flex: 1;
            }
            
            .registration-summary {
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .summary-item {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid #e9ecef;
            }
            
            .summary-item:last-child {
                border-bottom: none;
            }
            
            .summary-item .label {
                font-weight: bold;
                color: #495057;
            }
            
            .summary-item .value {
                color: #2ed573;
                font-weight: 500;
            }
            
            .step-header {
                text-align: center;
                color: #2c3e50;
                margin-bottom: 25px;
                font-size: 18px;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>