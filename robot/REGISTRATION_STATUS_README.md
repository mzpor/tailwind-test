# سیستم وضعیت ثبت‌نام ربات

## 📋 خلاصه
این سیستم به مدیر مدرسه امکان کنترل وضعیت ثبت‌نام را می‌دهد و بر اساس تنظیمات، دکمه ثبت‌نام را برای کاربران نمایش یا مخفی می‌کند.

## ✨ ویژگی‌های جدید

### 🎯 کنترل کامل دکمه ثبت‌نام
- **وقتی ثبت‌نام فعال است**: دکمه "📝 ثبت نام [ماه فعلی]" در کیبورد دانش‌آموز نمایش داده می‌شود
- **وقتی ثبت‌نام غیرفعال است**: دکمه کاملاً حذف می‌شود و پیام "📝 ثبت نام [ماه بعدی] بزودی..." نمایش داده می‌شود

### 📅 متن ماه‌های فارسی
- **ماه فعلی**: برای دکمه ثبت‌نام فعال (مثال: "📝 ثبت نام امرداد")
- **ماه بعدی**: برای پیام ثبت‌نام غیرفعال (مثال: "📝 ثبت نام شهریور بزودی...")
- **اتوماتیک**: بر اساس تاریخ شمسی فعلی محاسبه می‌شود

### 🔧 تنظیمات مدیر
- دکمه تنظیمات ثبت‌نام متن ماه را نمایش می‌دهد
- وضعیت فعال/غیرفعال با آیکون مناسب نمایش داده می‌شود

## 🛠️ فایل‌های تغییر یافته

### `robot/1time.js`
- اضافه شدن `getPersianMonthName()`: نام ماه فارسی فعلی
- اضافه شدن `getNextPersianMonthName()`: نام ماه فارسی بعدی  
- اضافه شدن `getRegistrationMonthText(isEnabled)`: متن مناسب بر اساس وضعیت

### `robot/5polling.js`
- **خطوط 340-439**: منطق `ROLES.STUDENT` برای نمایش/مخفی کردن دکمه ثبت‌نام
- **خطوط 740-839**: بررسی وضعیت ثبت‌نام در callback `student_registration`
- **تغییرات کلیدی**:
  - دکمه ثبت‌نام فقط وقتی `enabled: true` است اضافه می‌شود
  - در صورت غیرفعال بودن، دکمه کاملاً حذف می‌شود
  - متن ماه‌های فارسی برای دکمه و پیام استفاده می‌شود

### `robot/11settings.js`
- **خطوط 213-312**: `getMainSettingsKeyboard()` برای نمایش دکمه تنظیمات
- **خطوط 990-1089**: `handleToggleRegistration()` برای تغییر وضعیت
- **تغییرات کلیدی**:
  - دکمه تنظیمات متن ماه را نمایش می‌دهد
  - وضعیت فعال/غیرفعال با آیکون مناسب

### `robot/data/site-status.json`
- فایل تنظیمات مرکزی برای وضعیت ثبت‌نام
- شامل `enabled`, `lastUpdate`, `updatedFrom`, `maxCapacity`, `currentRegistrations`

## 🔄 نحوه کارکرد

### 1. فعال کردن ثبت‌نام
```
مدیر → تنظیمات → 📝 ثبت نام [ماه فعلی]: ✅ فعال
```
- دکمه ثبت‌نام در کیبورد دانش‌آموز نمایش داده می‌شود
- متن دکمه: "📝 ثبت نام [ماه فعلی]"

### 2. غیرفعال کردن ثبت‌نام
```
مدیر → تنظیمات → 📝 ثبت نام [ماه بعدی] بزودی...: ❌ غیرفعال
```
- دکمه ثبت‌نام از کیبورد دانش‌آموز حذف می‌شود
- پیام اطلاع‌رسانی: "📝 ثبت نام [ماه بعدی] بزودی..."

### 3. رفتار کاربر
- **دانش‌آموز/کاربر ناشناس**: دکمه ثبت‌نام بر اساس وضعیت نمایش/مخفی می‌شود
- **مدیر**: همیشه می‌تواند وضعیت را تغییر دهد
- **Callback**: اگر کاربر دکمه غیرفعال را کلیک کند، پیام خطا دریافت می‌کند

## 🧪 تست عملکرد

### تست کیبورد دانش‌آموز
```javascript
// وضعیت فعال
inlineKeyboard = [
  [{ text: '🤖 معرفی ربات', callback_data: 'intro_quran_bot' }],
  [{ text: '📝 ثبت نام امرداد', callback_data: 'student_registration' }]
];

// وضعیت غیرفعال  
inlineKeyboard = [
  [{ text: '🤖 معرفی ربات', callback_data: 'intro_quran_bot' }]
];
// دکمه ثبت‌نام حذف شده، فقط پیام "📝 ثبت نام شهریور بزودی..."
```

### تست متن ماه‌ها
```javascript
getRegistrationMonthText(true)   // "📝 ثبت نام امرداد"
getRegistrationMonthText(false)  // "📝 ثبت نام شهریور بزودی..."
```

## ⚠️ نکات مهم

1. **کاربران ناشناس**: به عنوان `ROLES.STUDENT` در نظر گرفته می‌شوند
2. **خطای فایل**: اگر `site-status.json` خوانده نشود، دکمه ثبت‌نام نمایش داده نمی‌شود
3. **تاریخ شمسی**: تمام محاسبات بر اساس تقویم شمسی انجام می‌شود
4. **کش**: تغییرات بلافاصله اعمال می‌شوند و نیازی به restart نیست

## 🔮 آینده

- امکان تنظیم تاریخ شروع و پایان ثبت‌نام
- نمایش تعداد ثبت‌نام‌های انجام شده
- اعلان خودکار برای شروع ثبت‌نام ماه بعد
- گزارش‌گیری از وضعیت ثبت‌نام‌ها
